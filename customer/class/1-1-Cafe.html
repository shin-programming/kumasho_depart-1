<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>熊デパ1-1店舗紹介</title>
  <link rel="stylesheet" href="../customer.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@500;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="main-header">
    <div class="header-inner">
      <h1>【Cafe Soluce】</h1>
      <p class="tagline">【キャッチコピー】</p>
    </div>
  </header>

  <section class="detail-section">
    <img src="img/1-1/*.jpg" alt="店舗写真" />
    <h2>店舗紹介</h2>
    <p>
      【PR文１】<br>
      【PR文２】
    </p>

    <h2>おすすめ商品</h2>
    <center>
    <div class="product-card-list">
      <div class="product-card">
        <img src="img/1-1/*.jpg" alt="おすすめ１">
        <div class="product-card-body">
          <h3>【おすすめ商品１】</h3>
          <p class="product-price">【値段】</p>
        </div>
      </div>
      <div class="product-card">
        <img src="img/1-1/*.jpg" alt="おすすめ２">
        <div class="product-card-body">
          <h3>【おすすめ商品２】</h3>
          <p class="product-price">【値段】</p>
        </div>
      </div>
      <div class="product-card">
        <img src="img/1-1/*.jpg" alt="おすすめ３">
        <div class="product-card-body">
          <h3>【おすすめ商品３】</h3>
          <p class="product-price">【値段】</p>
        </div>
      </div>
    </div>

    <!-- 販売状況ボタン -->
    <button class="show-status" data-class="1-1" data-company="TAKOMIYA EZUKO">全商品の販売状況はこちら</button>

    <!-- モーダルウィンドウ -->
    <div id="modal" class="hidden">
      <div id="modal-content">
        <span id="modal-close" style="font-size: 1.5rem;">&times;</span>
        <div id="modal-body">読み込み中...</div>
      </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const modal = document.getElementById('modal');
  const modalBody = document.getElementById('modal-body');
  const modalClose = document.getElementById('modal-close');

  const companyPageMap = {
    "TAKOMIYA EZUKO": "1-1-EZUKO.html",
    "Cafe Soluce": "1-1-Cafe.html"
    // 必要に応じてクラス別で編集
  };

  document.querySelectorAll('.show-status').forEach(button => {
    button.addEventListener('click', () => {
      const className = button.getAttribute('data-class');
      const companyName = button.getAttribute('data-company');
      const targetPage = companyPageMap[companyName];

      // ページ遷移に対応（別ページを開く用途）
      if (targetPage) {
        window.location.href = targetPage;
        return; // 遷移後はこのページの処理を続けない
      }

      // モーダル表示処理（企業ページがない場合）
      modal.classList.remove('hidden');
      document.body.classList.add('modal-open');
      modalBody.innerHTML = '読み込み中...';

      const Gas_Url = "https://script.google.com/macros/s/AKfycbzrGDAfgsDU5wQl3wW6QzokWE7Sm3YnM-n3IR9RX90OlNoWmCnH7zyV6jk7MnsWBK8M/exec?sheet=1-1"
      fetch(Gas_Url)
        .then(response => response.json())
        .then(data => {
          let companies = [];
          let currentCompany = null;

          data.forEach(item => {
            if (item.company_name) {
              currentCompany = {
                company_name: item.company_name,
                products: []
              };
              companies.push(currentCompany);
            } else if (item.pdname && currentCompany) {
              currentCompany.products.push(item);
            }
          });

          modalBody.innerHTML = companies.map(company => {
            const companyHeader = `<h3 style="margin-top: 1em;">${company.company_name}</h3>`;
            const productList = company.products.map(item => {
              const isSoldOut = item.sales === "完売";
              return `<div class="item" style="margin-bottom: 16px;">
                <strong>${item.pdname}</strong><br>
                価格: ¥${item.price.toLocaleString()}<br>
                販売状況: <span style="color:${isSoldOut ? 'red' : 'black'};">${item.sales}</span>
              </div>`;
            }).join('');
            return companyHeader + productList;
          }).join('');
        })
        .catch(error => {
          console.error(error);
          modalBody.innerHTML = 'データの取得に失敗しました。';
        });
    });
  });

  modalClose.addEventListener('click', () => {
    modal.classList.add('hidden');
    document.body.classList.remove('modal-open');
  });

  window.addEventListener('click', (e) => {
    if (e.target.id === 'modal') {
      modal.classList.add('hidden');
      document.body.classList.remove('modal-open');
    }
  });

  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      modal.classList.add('hidden');
      document.body.classList.remove('modal-open');
    }
  });
});
</script>

    </center>
    <a href="../store.html" class="back-link">← クラス一覧に戻る</a>
  </section>

  <footer>
    <p>公式インスタグラム: <a href="https://www.instagram.com/kumasho.dept/" target="_blank">kumasho.dept</a></p>
    <small>© 課題研究 アプリ開発班</small>
  </footer>
</body>
</html>
